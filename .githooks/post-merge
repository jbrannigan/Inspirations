#!/usr/bin/env bash
set -u

repo_root="$(git rev-parse --show-toplevel)"
log_dir="$repo_root/data/session_checkpoints"
log_file="$log_dir/post_merge_hook.log"
mkdir -p "$log_dir"

{
  echo "[$(date -u +%Y-%m-%dT%H:%M:%SZ)] post-merge start squash=${1:-0}"
  python3 "$repo_root/tools/post_merge_maintenance.py" --repo "$repo_root" --hook-source post-merge --squash "${1:-0}"
  echo "[$(date -u +%Y-%m-%dT%H:%M:%SZ)] post-merge end"
} >>"$log_file" 2>&1 || true

exit 0
